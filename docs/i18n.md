# Internationalization (i18n) Guide

This guide explains how to use the internationalization system in the Akari v2 app.

## Overview

The app uses `expo-localization` and `i18n-js` to provide multi-language support. Currently, the app supports:

- English (en)
- Japanese (ja)
- Arabic (ar)
- French (fr)

## Setup

The i18n system is automatically initialized when the app starts. The configuration is in `utils/i18n.ts`.

## Usage

### Using the useTranslation Hook

The easiest way to use translations is with the `useTranslation` hook:

```tsx
import { useTranslation } from "@/hooks/useTranslation";

function MyComponent() {
  const { t, currentLocale, changeLanguage } = useTranslation();

  return <Text>{t("common.loading")}</Text>;
}
```

### Using the LocalizedText Component

For text that needs proper RTL support and language attributes (especially on web):

```tsx
import { LocalizedText } from "@/components/LocalizedText";

function MyComponent() {
  return (
    <LocalizedText translationKey="common.loading">Loading...</LocalizedText>
  );
}
```

### Translation Keys Structure

Translations are organized in nested objects:

```typescript
{
  en: {
    common: {
      loading: 'Loading...',
      error: 'Error',
      // ...
    },
    auth: {
      signInTitle: 'Sign In',
      // ...
    },
    navigation: {
      home: 'Home',
      // ...
    },
    posts: {
      newPost: 'New Post',
      // ...
    },
    profile: {
      editProfile: 'Edit Profile',
      // ...
    },
    settings: {
      account: 'Account',
      // ...
    }
  },
  ja: {
    // Same structure with Japanese translations
  },
  ar: {
    // Same structure with Arabic translations
  },
  fr: {
    // Same structure with French translations
  }
}
```

### Adding New Translations

1. Add the English translation to the `en` object in `utils/i18n.ts`
2. Add the corresponding translations to the `ja`, `ar`, and `fr` objects
3. Use the translation key in your component

Example:

```typescript
// In utils/i18n.ts
en: {
  common: {
    newFeature: 'New Feature',
  }
},
ja: {
  common: {
    newFeature: '新機能',
  }
},
ar: {
  common: {
    newFeature: 'ميزة جديدة',
  }
},
fr: {
  common: {
    newFeature: 'Nouvelle fonctionnalité',
  }
}

// In your component
const { t } = useTranslation();
<Text>{t('common.newFeature')}</Text>;
```

### Language Selection

Users can change the language in the Settings screen using the LanguageSelector component. The language preference is stored in the app's state and persists during the session.

### RTL Support

The app supports Right-to-Left (RTL) languages. When the device is set to an RTL language (like Arabic):

- Text alignment automatically adjusts
- Layout direction changes appropriately
- The `LocalizedText` component handles RTL text direction

### Web Support

On web platforms, the `LocalizedText` component automatically adds:

- `lang` attribute with the current language code
- `dir` attribute with the text direction

### Fallback

If a translation is missing in the current language, the system falls back to English.

## Configuration

### Supported Locales

Configure supported locales in `app.json`:

```json
{
  "expo": {
    "plugins": [
      [
        "expo-localization",
        {
          "supportedLocales": {
            "ios": ["en", "ja", "ar", "fr"],
            "android": ["en", "ja", "ar", "fr"]
          }
        }
      ]
    ]
  }
}
```

### RTL Support

Enable RTL support in `app.json`:

```json
{
  "expo": {
    "extra": {
      "supportsRTL": true
    }
  }
}
```

### iOS Mixed Localizations

Enable mixed localizations for iOS in `app.json`:

```json
{
  "expo": {
    "ios": {
      "infoPlist": {
        "CFBundleAllowMixedLocalizations": true
      }
    }
  }
}
```

## Best Practices

1. **Use descriptive keys**: Use nested keys that describe the context (e.g., `auth.signInTitle` instead of just `signIn`)

2. **Keep translations organized**: Group related translations together (common, auth, navigation, etc.)

3. **Use the LocalizedText component for user-facing text**: This ensures proper RTL support and language attributes

4. **Test with different languages**: Always test your app with different language settings, especially RTL languages like Arabic

5. **Consider text length**: Some languages have longer text than others, so design your UI to accommodate this

6. **Use translation options for dynamic content**: For text with variables, use the options parameter:

```tsx
// In translations
{
  welcome: "Welcome, {{name}}!";
}

// In component
const { t } = useTranslation();
<Text>{t("welcome", { name: "John" })}</Text>;
```

## Adding New Languages

To add a new language:

1. Add the language code to the supported locales in `app.json`
2. Add the language object to the translations in `utils/i18n.ts`
3. Add the language to the `LanguageSelector` component
4. Test the app with the new language

Example for adding Spanish:

```typescript
// In utils/i18n.ts
const translations = {
  en: {
    /* English translations */
  },
  ja: {
    /* Japanese translations */
  },
  ar: {
    /* Arabic translations */
  },
  fr: {
    /* French translations */
  },
  es: {
    /* Spanish translations */
  },
};

// In components/LanguageSelector.tsx
const languages: LanguageOption[] = [
  { code: "en", name: "English", nativeName: "English" },
  { code: "ja", name: "Japanese", nativeName: "日本語" },
  { code: "ar", name: "Arabic", nativeName: "العربية" },
  { code: "fr", name: "French", nativeName: "Français" },
  { code: "es", name: "Spanish", nativeName: "Español" },
];
```

## Troubleshooting

### Translation not showing

- Check that the translation key exists in all language objects (en, ja, ar, fr)
- Verify the key path is correct (e.g., `common.loading` not `common.loading`)
- Make sure the `useTranslation` hook is being used correctly

### RTL not working

- Ensure `supportsRTL: true` is set in `app.json`
- Use the `LocalizedText` component for text that needs RTL support
- Check that the device language is set to an RTL language (Arabic)

### Language not changing

- Verify the language code is supported in `app.json`
- Check that the language is added to the `LanguageSelector` component
- Ensure the `changeLanguage` function is being called correctly
